"use strict";(self.webpackChunkdemo=self.webpackChunkdemo||[]).push([[97352],{97352:($,C,i)=>{i.r(C),i.d(C,{default:()=>V});var t=i(35548),f=i(54795),c=i(66094),d=i(69104),h=i(39908),v=i(40970),g=i(4594),p=i(26856),u=i(37399),x=i(98808),_=i(60902),M=i(275),l=i(51160);const m={ByNewCard:0,BySavedCard:1};var y=i(84439);const P=[{cardId:"1",firstSix:"4242",lastFour:"4242",cardType:"Visa"},{cardId:"2",firstSix:"5555",lastFour:"4444",cardType:"MasterCard"},{cardId:"3",firstSix:"2200",lastFour:"6404",cardType:"Mir"}];let T=(()=>{var n;class a{constructor(){this.isE2E=(0,t.f3M)(u.TUI_IS_E2E)}preparePayment(e){return(0,y.H)(this.getRandomDelay()).pipe((0,l.U)(()=>e))}getPrimaryCard(){return(0,y.H)(this.getRandomDelay()).pipe((0,l.U)(()=>P),(0,l.U)(e=>({primary:e[0],cards:e})))}pay(){return(0,y.H)(this.getRandomDelay()).pipe((0,l.U)(()=>{}))}getRandomDelay(){return this.isE2E?0:3e3*Math.random()}}return(n=a).\u0275fac=function(e){return new(e||n)},n.\u0275prov=t.Yz7({token:n,factory:n.\u0275fac,providedIn:"root"}),a})();const O=["cardGroupedInput"];function k(n,a){if(1&n){const r=t.EpF();t.ynx(0),t.TgZ(1,"div",4)(2,"div",9),t.NdJ("click",function(){const s=t.CHM(r).$implicit,F=t.oxw();return t.KtG(F.payBySelectedCard(s))}),t.TgZ(3,"div",10)(4,"div",11)(5,"div",12),t._uU(6,"Card number"),t.qZA(),t.TgZ(7,"div",13),t._UZ(8,"tui-svg",14),t.TgZ(9,"div",15),t._uU(10),t.qZA()()()()()(),t.BQk()}if(2&n){const r=a.$implicit;t.xp6(8),t.Q6J("src","MasterCard"===r.cardType?"tuiIconMaestro":"Visa"===r.cardType?"tuiIconVisa":"tuiIconMir"),t.xp6(2),t.AsE(" ",r.firstSix,"****",r.lastFour," ")}}function Z(n,a){1&n&&(t.ynx(0),t._UZ(1,"input",16),t.BQk())}function I(n,a){1&n&&(t.TgZ(0,"p"),t._uU(1,"Please wait, we are loading fake cards..."),t.qZA())}function N(n,a){if(1&n&&(t.ynx(0),t.YNc(1,I,2,0,"p",5),t.TgZ(2,"tui-loader",17),t._UZ(3,"tui-input-card-grouped",18,19),t.qZA(),t.BQk()),2&n){const r=a.tuiLet,e=t.oxw();t.xp6(1),t.Q6J("ngIf",r),t.xp6(1),t.Q6J("overlay",!0)("showLoader",r),t.xp6(1),t.ekj("without-date",e.paymentMode===e.PAYMENT_MODE.BySavedCard),t.Q6J("autocomplete",!0)("cardValidator",e.cardValidator)("tuiTextfieldCleaner",e.paymentMode===e.PAYMENT_MODE.ByNewCard)}}function S(n,a){1&n&&(t.ynx(0),t.TgZ(1,"div",4)(2,"label",20),t._UZ(3,"input",21),t._uU(4," Remember card "),t.qZA()(),t.BQk())}function B(n,a){if(1&n){const r=t.EpF();t.TgZ(0,"div",22)(1,"button",23),t.NdJ("click",function(){t.CHM(r);const o=t.oxw();return t.KtG(o.payByNewCard())}),t._uU(2," New card "),t.qZA()()}}let A=(()=>{var n;class a{constructor(){var e,o;this.payService=(0,t.f3M)(T),this.destroyRef=(0,t.f3M)(t.ktI),this.form=new c.cw({card:new c.NI(null,[c.kI.required,n=>{const{value:a}=n;return null!=a&&a.cvc&&a.cvc.length<3?{invalidCvc:!0}:null}]),saveCard:new c.NI(!0)}),this.context=(0,t.f3M)(v.yf),this.iOS=(0,t.f3M)(u.TUI_IS_IOS),this.cards=[],this.paymentMode=m.ByNewCard,this.loading$=new _.X(!1),this.payProcessing$=new _.X(!1),this.amount=(null==(o=null==(e=this.context)?void 0:e.data)?void 0:o.amount)??0,this.PAYMENT_MODE=m}ngOnInit(){this.fetchCardsAndSetPrimaryCard()}payBySelectedCard(e){var o;this.form.patchValue({card:{card:this.maskedNumber(e),expire:"**/**",cvc:""}}),this.form.controls.card.removeValidators(p.tuiCardNumberValidator),this.paymentMode=m.BySavedCard,null==(o=this.cardGroupedInput)||o.focusCVC()}payByNewCard(){var e;this.form.patchValue({card:null}),this.form.controls.card.addValidators(p.tuiCardNumberValidator),this.paymentMode=m.ByNewCard,null==(e=this.cardGroupedInput)||e.focusCard()}pay(){this.form.controls.card.valid&&(this.payProcessing$.next(!0),this.payService.pay().pipe((0,f.sL)(this.destroyRef)).subscribe(()=>{this.payProcessing$.next(!1),this.context.$implicit.complete()},()=>this.payProcessing$.next(!1)))}cardValidator(e){return(0,p.tuiDefaultCardValidator)(e)&&16===e.length}maskedNumber(e){return`${e.firstSix.toString().slice(0,-2)}***${e.lastFour}`}fetchCardsAndSetPrimaryCard(){this.loading$.next(!0),this.payService.preparePayment(this.context.data.amount).pipe((0,M.w)(e=>this.payService.getPrimaryCard().pipe((0,l.U)(o=>[e,o]))),(0,f.sL)(this.destroyRef)).subscribe({next:([,e])=>{this.cards=e.cards,e.primary?this.payBySelectedCard(e.primary):this.payByNewCard()},complete:()=>this.loading$.next(!1)})}}return(n=a).\u0275fac=function(e){return new(e||n)},n.\u0275cmp=t.Xpm({type:n,selectors:[["pay-modal"]],viewQuery:function(e,o){if(1&e&&t.Gf(O,5),2&e){let s;t.iGM(s=t.CRH())&&(o.cardGroupedInput=s.first)}},standalone:!0,features:[t.jDz],decls:16,vars:16,consts:[[1,"modal-container"],[1,"title"],[3,"formGroup"],[4,"ngFor","ngForOf"],[1,"form-block"],[4,"ngIf"],[4,"tuiLet"],["class","form-block is--links",4,"ngIf"],["appearance","primary","size","l","tuiButton","","type","submit",3,"loading","click"],[1,"saved-card-preset",3,"click"],[1,"saved-card-preset__item"],[1,"saved-card-preset__item__inner"],[1,"saved-card-preset__item__placeholder"],[1,"saved-card-preset__item__info"],[1,"saved-card-preset__item__info__icon",3,"src"],[1,"saved-card-preset__item__info__number"],["autocomplete","cc-number","inputmode","numeric","maxlength","0","tuiAutoFocus","",1,"fake-input"],[3,"overlay","showLoader"],["formControlName","card",3,"autocomplete","cardValidator","tuiTextfieldCleaner"],["cardGroupedInput",""],["tuiLabel",""],["formControlName","saveCard","tuiCheckbox","","type","checkbox"],[1,"form-block","is--links"],["iconLeft","tuiIconPlus","tuiLink","",3,"click"]],template:function(e,o){if(1&e&&(t.TgZ(0,"div",0)(1,"h1",1),t._uU(2,"Pay by card"),t.qZA(),t.TgZ(3,"form",2),t.YNc(4,k,11,3,"ng-container",3),t.TgZ(5,"div",4),t.YNc(6,Z,2,0,"ng-container",5),t.YNc(7,N,5,8,"ng-container",6),t.ALo(8,"async"),t.qZA(),t.YNc(9,S,5,0,"ng-container",5),t.YNc(10,B,3,0,"div",7),t.qZA(),t.TgZ(11,"button",8),t.NdJ("click",function(){return o.pay()}),t.ALo(12,"async"),t._uU(13),t.ALo(14,"async"),t.ALo(15,"tuiFormatNumber"),t.qZA()()),2&e){let s;t.xp6(3),t.Q6J("formGroup",o.form),t.xp6(1),t.Q6J("ngForOf",o.cards),t.xp6(2),t.Q6J("ngIf",o.iOS),t.xp6(1),t.Q6J("tuiLet",null!==(s=t.lcZ(8,8,o.loading$))&&void 0!==s&&s),t.xp6(2),t.Q6J("ngIf",o.paymentMode===o.PAYMENT_MODE.ByNewCard),t.xp6(1),t.Q6J("ngIf",o.paymentMode===o.PAYMENT_MODE.BySavedCard),t.xp6(1),t.Q6J("loading",!!t.lcZ(12,10,o.payProcessing$)),t.xp6(2),t.hij(" Pay ",t.lcZ(14,12,t.lcZ(15,14,o.amount))," \u20bd ")}},dependencies:[c.UX,c._Y,c.Wl,c.JJ,c.JL,c.sg,c.u,g.sg,d.TuiSvgComponent,g.O5,d.TuiLinkDirective,d.TuiButtonDirective,x.TuiButtonLoadingComponent,g.Ov,d.TuiFormatNumberPipe,u.TuiLetDirective,u.TuiAutoFocusDirective,d.TuiLoaderComponent,p.TuiInputCardGroupedComponent,d.TuiTextfieldOptionsDirective,d.TuiLabelDirective,x.TuiCheckboxComponent],styles:["[_nghost-%COMP%]     tui-input-card-grouped{width:100%!important}[_nghost-%COMP%]     tui-input-card-grouped.without-date .t-wrapper_expire{display:none}[_nghost-%COMP%]     tui-input-card-grouped.without-date tui-svg[src=tuiIconClose]{display:none}[_nghost-%COMP%]     tui-input-card-grouped .t-value_collapsed{letter-spacing:.1px}.modal-container[_ngcontent-%COMP%]{width:480px}@media screen and (max-width: 599px){.modal-container[_ngcontent-%COMP%]{width:100%}}.title[_ngcontent-%COMP%]{margin:0 0 16px;font-weight:500;font-size:18px;line-height:26px;letter-spacing:.18px}.form-block[_ngcontent-%COMP%]{position:relative;margin-bottom:16px}.form-block[_ngcontent-%COMP%]   .saved-card-preset__item[_ngcontent-%COMP%]{height:56px;background:#fafbfb;border-radius:16px;border:2px solid #eaeaea;padding:0 16px;display:flex;align-items:center;cursor:pointer}.form-block[_ngcontent-%COMP%]   .saved-card-preset__item__placeholder[_ngcontent-%COMP%]{color:#717172;letter-spacing:.24px;font-size:12px;line-height:18px}.form-block[_ngcontent-%COMP%]   .saved-card-preset__item__info[_ngcontent-%COMP%]{display:flex;align-items:center}.form-block[_ngcontent-%COMP%]   .saved-card-preset__item__info__icon[_ngcontent-%COMP%]{width:36px;height:22px;background-position:center;background-repeat:no-repeat;margin-right:8px}.form-block[_ngcontent-%COMP%]   .saved-card-preset__item__info__number[_ngcontent-%COMP%]{letter-spacing:.2px;line-height:22px;color:#313132}.form-block.is--links[_ngcontent-%COMP%]{display:flex;align-items:center}.form-block.is--links[_ngcontent-%COMP%]     a{font-weight:400;font-size:14px;line-height:20px}.form-block.is--links[_ngcontent-%COMP%]     a:first-child{color:#6496dc}.form-block.is--links[_ngcontent-%COMP%]     a:last-child{color:#b0b0b0;margin-left:auto}.fake-input[_ngcontent-%COMP%]{position:absolute;bottom:0;left:0;z-index:-9999999;width:100%;caret-color:transparent;cursor:none;color:transparent}"],changeDetection:0}),a})();var D=i(59756),E=i(74922),w=i(139),L=i(46953),U=i(10188),J=i(85454),Q=i(40661);const V=(()=>{var n;class a{constructor(){this.dialogs=(0,t.f3M)(d.TuiDialogService),this.destroyRef=(0,t.f3M)(t.ktI),this.amountControl=new c.NI(100)}payByCard(){this.dialogs.open(new v.Al(A),{size:"auto",closeable:!0,data:{amount:this.amountControl.value}}).pipe((0,f.sL)(this.destroyRef)).subscribe()}}return(n=a).\u0275fac=function(e){return new(e||n)},n.\u0275cmp=t.Xpm({type:n,selectors:[["ng-component"]],standalone:!0,exportAs:"ExampleComponent9",features:[t.jDz],decls:10,vars:3,consts:[[1,"container"],["tuiHintContent","The amount must be less than 1000 \u20bd","tuiHintDirection","top","tuiTextfieldPostfix","\u20bd","tuiTextfieldSize","l",3,"formControl","tuiTextfieldCleaner","tuiTextfieldLabelOutside"],["inputmode","numeric","maxlength","5","tuiTextfieldLegacy",""],["tuiButton","",1,"pay-button",3,"click"],[1,"icon-group"],["src","tuiIconVisa"],["src","tuiIconMaestro"],["src","tuiIconMir"]],template:function(e,o){1&e&&(t.TgZ(0,"div",0)(1,"tui-input-number",1),t._uU(2," 0 ... 999 \u20bd "),t._UZ(3,"input",2),t.qZA(),t.TgZ(4,"button",3),t.NdJ("click",function(){return o.payByCard()}),t.TgZ(5,"div",4),t._UZ(6,"tui-svg",5)(7,"tui-svg",6)(8,"tui-svg",7),t.qZA(),t._uU(9," Pay "),t.qZA()()),2&e&&(t.xp6(1),t.Q6J("formControl",o.amountControl)("tuiTextfieldCleaner",!0)("tuiTextfieldLabelOutside",!0))},dependencies:[h._Hh,D.q,E.g,w.M,c.UX,c.JJ,c.oH,d.TuiTextfieldOptionsDirective,h.cnw,L.b,U.x,J.s,Q.T,d.TuiHintOptionsDirective,d.TuiButtonDirective,d.TuiSvgComponent],styles:[".container[_ngcontent-%COMP%]{width:100%;max-width:30rem;margin:0 auto;padding-top:1.25rem}.pay-button[_ngcontent-%COMP%]{margin-top:1rem;width:100%}.icon-group[_ngcontent-%COMP%]{display:flex;gap:.125rem;background:#f6f6f6;padding:.125rem .3125rem;margin-right:.5rem;border-radius:.3125rem}"],changeDetection:0}),a})()}}]);